<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MergePoint | AI RFP Platform</title>
    <link rel="stylesheet" href="style.css">
    
    <script src="https://unpkg.com/lucide@latest"></script>

    <script>
    // This runs INSTANTLY before the rest of the page loads
    (function() {
        const savedName = localStorage.getItem('userDisplayName');
        const savedInitial = localStorage.getItem('userInitial');
        
        if (savedName && savedInitial) {
            // We use a small interval just to ensure the DOM elements exist
            const checkExist = setInterval(function() {
                const nameEl = document.getElementById('display-name');
                const avatarEl = document.getElementById('avatar-circle');
                
                if (nameEl && avatarEl) {
                    nameEl.textContent = savedName;
                    avatarEl.textContent = savedInitial;
                    clearInterval(checkExist);
                }
            }, 5); // Checks every 5ms
        }
    })();
</script>

    <script>
        (function() {
            const isCollapsed = localStorage.getItem('sidebar-collapsed') === 'true';
            if (isCollapsed) {
                document.documentElement.classList.add('sidebar-is-collapsed');
            }
        })();
    </script>
</head>
<body>
    <div class="dashboard-container">
        <nav class="sidebar" id="sidebar">
    <div class="logo">MergePoint</div>
    <button id="sidebar-toggle" class="toggle-btn">
            <i data-lucide="chevron-left"></i>
        </button>
    
    <ul class="nav-links">
        <li class="active"><a href="index.html"><i data-lucide="clipboard-list"></i> <span>Active Bids</span></a></li>
        <li><a href="knowledge.html"><i data-lucide="book-open"></i> <span>Knowledge Base</span></a></li>
        <li><a href="archive.html"><i data-lucide="archive"></i> <span>RFP Library</span></a></li>
        <hr style="border: 0; border-top: 1px solid rgba(255,255,255,0.1); margin: 1rem 0;">
        <li><a href="#"><i data-lucide="users"></i> <span>Team Hub</span></a></li>
        <li><a href="settings.html"><i data-lucide="sliders"></i> <span>Settings</span></a></li>
    </ul>

    <div class="sidebar-footer">
        <div class="user-profile-mini">
        <div class="avatar" id="avatar-circle">?</div>
        <div class="user-info">
            <span class="user-name" id="display-name">Loading...</span>
            <span class="user-role" id="display-role" style="font-size: 0.7rem; color: rgba(255,255,255,0.5); display: block;">Role</span>
        </div>
    </div>
    <ul class="nav-links logout-nav">
        <li>
            <a href="#" id="logout-btn" class="logout-link">
                <i data-lucide="log-out"></i> <span>Logout</span>
            </a>
            </li>
        </ul>
    </div>
</nav>

<main class="main-content">
    <header class="top-bar">
        <div class="workspace-nav-header">
            <div class="title-group">
                <h1 id="bid-title">Loading...</h1>
                <span class="status-tag" id="bid-status">SYNCING</span>

                <div class="progress-container" style="width: 200px; height: 8px; background: #e2e8f0; border-radius: 10px; margin-left: 1.5rem; position: relative; overflow: hidden;">
        <div id="overall-progress-bar" style="width: 0%; height: 100%; background: #6366f1; transition: width 0.4s ease;"></div>
    </div>
    <span id="progress-text" style="font-size: 0.75rem; color: #64748b; margin-left: 8px; font-weight: 600;">0%</span>
            </div>
            
            <div class="header-actions">
                <button class="btn-secondary-outline" id="save-bid-btn">
                    <i data-lucide="save"></i> Save Draft
                </button>
                <button class="btn-primary" id="submit-review-btn">
                    <i data-lucide="send"></i> Submit for Review
                </button>
            </div>
        </div>
    </header>

    <div class="workspace-layout">
        <section class="editor-container">
    <div class="editor-toolbar">
        <div class="text-tools">
            <button title="Bold"><i data-lucide="bold"></i></button>
            <button title="Italic"><i data-lucide="italic"></i></button>
            <button title="List"><i data-lucide="list"></i></button>
        </div>
        
        <button class="btn-ai-magic" id="magic-draft-btn">
            <i data-lucide="wand-2"></i> Generate AI Draft
        </button>
    </div>

    <div id="active-question-bar" style="padding: 10px 20px; background: #f1f5f9; border-bottom: 1px solid #e5e7eb; font-size: 0.85rem; color: #475569;">
        <strong>Editing:</strong> <span id="current-section-name">Select a section from the right...</span>
    </div>

    <textarea id="ai-content-editor" placeholder="Select a question from the right to start drafting..."></textarea>
    
    <div class="editor-footer">
        <div class="stat"><i data-lucide="type"></i> <span id="word-count">0</span> words</div>
        <div class="stat"><i data-lucide="shield-check"></i> <span id="confidence-level">--</span> confidence</div>
    </div>
</section>

        <aside class="workspace-sidebar">
            <div class="insight-card sections-container">
                <h3><i data-lucide="list-checks"></i> Tender Sections</h3>
                <div id="sections-list" class="sections-menu">
                    <p class="loading-text">Extracting questions...</p>
                </div>
            </div>

            <div class="insight-card">
                <button class="btn-hero" id="generate-response-btn" style="width: 100%; margin: 0;">
                    <i data-lucide="sparkles"></i> Re-Analyze Doc
                </button>
            </div>

            <div class="insight-card">
                <h3><i data-lucide="zap"></i> Key Details</h3>
                <p id="client-name" style="font-size: 0.9rem;"><strong>Client:</strong> ---</p>
                <p id="bid-deadline" style="font-size: 0.9rem;"><strong>Due:</strong> ---</p>
            </div>
        </aside>
    </div>
</main>

    <div id="review-modal" class="modal">
        <div class="modal-content">
            <h3>Submit for Review</h3>
            <p>Enter the email address of the reviewer:</p>
            <input type="email" id="reviewer-email" placeholder="colleague@company.com">
            <div class="modal-actions">
                <button class="btn-secondary" onclick="closeModal()">Cancel</button>
                <button class="btn-primary" id="confirm-submit-btn">Send to Reviewer</button>
            </div>
        </div>
    </div>

    <div id="toast-container" class="toast-container"></div>

    <script src="https://unpkg.com/lucide@latest"></script>
    <script>lucide.createIcons();</script>
    <script type="module" src="workspace.js"></script>
</body>
</html>